<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShopClone — Amazon Style Store</title>
<link rel="stylesheet" href="styles.css">
<style>
    .header { display:flex; justify-content:space-between; align-items:center; padding:10px; background:#232f3e; color:white; }
    .search-bar input { padding:5px; }
    .categories { display:flex; gap:10px; padding:10px; background:#37475a; }
    .categories a { color:white; text-decoration:none; }
    .products { display:flex; flex-wrap:wrap; gap:10px; padding:10px; }
    .product { border:1px solid #ccc; padding:10px; flex:1 1 150px; text-align:center; }
    .product img { width:150px; height:150px; object-fit:cover; display:block; margin:0 auto 5px; }
    .header-buttons { display:flex; align-items:center; gap:10px; }
    .sign-in-btn { padding:5px 10px; background:#febd69; border:none; cursor:pointer; }
</style>
</head>
<body>

<header class="header">
    <div class="logo">
        <a href="#" id="logoLink" style="color:white; text-decoration:none; font-weight:bold; font-size:24px;">ShopClone</a>
    </div>
    <div class="search-bar" style="flex:1; margin:0 20px; display:flex; align-items:center;">
        <input type="text" placeholder="Search products…" id="searchInput" style="flex:1; padding:6px 10px; font-size:14px; border:none; border-radius:4px 0 0 4px; height:32px;">
        <button style="padding:8px 16px; font-size:14px; border:none; background:#febd69; cursor:pointer; border-radius:0 4px 4px 0; height:44px;">Search</button>
    </div>
    <div class="header-right" style="display:flex; gap:20px; align-items:center;">
        <div class="account" style="text-align:center; cursor:pointer;">
            <div style="font-size:12px;">Hello, Sign in</div>
            <div style="font-weight:bold;">Account & Lists</div>
        </div>
        <div class="orders" style="text-align:center; cursor:pointer;">
            <div style="font-size:12px;">Returns</div>
            <div style="font-weight:bold;">& Orders</div>
        </div>
        <div class="cart" id="cartIcon" style="position:relative; cursor:pointer;">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/shopping-cart.png"/>
            <span id="cartCount" style="position:absolute; top:-5px; right:-5px; background:red; border-radius:50%; padding:2px 6px; font-size:12px;">0</span>
        </div>
    </div>
</header>

<div id="authBox" style="padding:15px; background:#fff3cd; display:none;">
    <h3>Sign In</h3>

    <button id="googleLogin" 
        style="padding:8px; background:#4285F4; color:white; border:none; cursor:pointer;">
        Sign in with Google
    </button>

    <br><br>

    <input id="emailInput" type="email" placeholder="Email"
        style="padding:8px; width:200px;"><br><br>

    <input id="passwordInput" type="password" placeholder="Password"
        style="padding:8px; width:200px;"><br><br>

    <button id="emailLogin" style="padding:8px; background:#febd69; border:none; cursor:pointer;">
        Sign in with Email
    </button>

    <button id="emailSignup" style="padding:8px; background:#ffa41c; border:none; cursor:pointer;">
        Create Account
    </button>

    <br><br>
    <button id="closeAuth" style="padding:5px;">Close</button>
</div>


<nav class="categories">
    <a href="#" data-category="electronics">Electronics</a>
    <a href="#" data-category="clothing">Clothing</a>
    <a href="#" data-category="games">Games</a>
    <a href="#" data-category="fitness">Fitness</a>
     <a href="#" data-category="beauty">beauty</a>
     <a href="#" data-category="health">health</a>
    <a href="#" data-category="automotive">Automotive</a>
    <a href="#" data-category="more">More</a>
</nav>

<section class="products" id="productGrid"></section>

<script type="module">
/* -------------------- IMPORTS ----------------------- */
import { db, auth } from './firebaseConfig.js';
import { collection, query, where, getDocs, doc, setDoc, getDoc } 
    from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";




/* -------------------- AUTH IMPORTS (ADD THESE) ----------------------- */
import { 
    GoogleAuthProvider, signInWithPopup,
    signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";


/* -------------------- AUTH BUTTON LOGIC (ADD THIS) ----------------------- */

// Open login popup
document.querySelector(".account").onclick = () => {
    document.getElementById("authBox").style.display = "block";
};

// Close login popup
document.getElementById("closeAuth").onclick = () => {
    document.getElementById("authBox").style.display = "none";
};

// GOOGLE LOGIN
document.getElementById("googleLogin").onclick = async () => {
    try {
        await signInWithPopup(auth, new GoogleAuthProvider());
        alert("Logged in with Google!");
        document.getElementById("authBox").style.display = "none";
        await loadCartFromFirebase();
    } catch (e) {
        alert(e.message);
    }
};

// EMAIL LOGIN
document.getElementById("emailLogin").onclick = async () => {
    const email = emailInput.value;
    const pass = passwordInput.value;

    try {
        await signInWithEmailAndPassword(auth, email, pass);
        alert("Logged in!");
        document.getElementById("authBox").style.display = "none";
        await loadCartFromFirebase();
    } catch (e) {
        alert(e.message);
    }
};

// EMAIL SIGNUP
document.getElementById("emailSignup").onclick = async () => {
    const email = emailInput.value;
    const pass = passwordInput.value;

    try {
        await createUserWithEmailAndPassword(auth, email, pass);
        alert("Account created!");
        document.getElementById("authBox").style.display = "none";
    } catch (e) {
        alert(e.message);
    }
};

// LOGOUT on right-click
document.querySelector(".account").oncontextmenu = async e => {
    e.preventDefault();
    await signOut(auth);
    alert("Logged out!");
    cart = [];
    document.getElementById("cartCount").innerText = 0;
};



/* -------------------- YOUR EXISTING CODE CONTINUES BELOW ----------------------- */

let cart = [];
let currentUser = null;



const productsData = {
    home: [{name:"Welcome to ShopClone!", price:0, img:""}],
    electronics: [
        {name:"Laptop", price:899.99, images:["https://via.placeholder.com/150/0000FF","https://via.placeholder.com/150/FF0000","https://via.placeholder.com/150/00FF00"]},
        {name:"Smartphone", price:399.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
        {name:"Headphones", price:129.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    clothing: [
        {name:"T-Shirt", price:19.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
        {name:"Jeans", price:49.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    games: [
        {name:"Console", price:399.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    fitness: [
        {name:"Dumbbells", price:49.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    beauty: [
        {name:"Lotion", price:49.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    health: [
        {name:"vitamins", price:49.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    automotive: [
    {name:"Car Oil", price:29.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Tire", price:129.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"GPS Navigator", price:199.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Car Cover", price:59.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Car Battery", price:89.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Car Vacuum", price:39.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Windshield Wipers", price:24.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
],

    more: [
        {name:"Books", price:14.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ]
};




/* -------------------- LOGIN STATE TRACKING ----------------------- */
auth.onAuthStateChanged(async user => {
    currentUser = user;

    if (user) {
        console.log("User logged in:", user.uid);
        await loadCartFromFirebase();
    } else {
        console.log("No user logged in");
    }
});


/* -------------------- SAVE CART TO FIREBASE ----------------------- */
async function saveCartToFirebase() {
    if (!currentUser) return;
    await setDoc(doc(db, "carts", currentUser.uid), {
        items: cart
    });
}



/* -------------------- LOAD CART FROM FIREBASE ----------------------- */
async function loadCartFromFirebase() {
    if (!currentUser) return;
    const ref = doc(db, "carts", currentUser.uid);
    const snap = await getDoc(ref);

    if (snap.exists()) {
        cart = snap.data().items;
        document.getElementById("cartCount").innerText = cart.length;
    }
}

/* -------------------- RENDER PRODUCTS ----------------------- */

async function renderProducts(category) {
    const grid = document.getElementById("productGrid");
    grid.innerHTML = "";

    if (category === "home") {
        grid.innerHTML = "<h2>Welcome to ShopClone!</h2>";
        return;
    }

    try {
        const q = query(collection(db, "products"), where("category", "==", category));
        const snapshot = await getDocs(q);

        snapshot.forEach(doc => addProductToGrid(doc.data(), grid));

    } catch (err) {
        console.error(err);
        grid.innerHTML = "<p>Error loading products.</p>";
    }
}
/* -------------------- ADD PRODUCT CARD ----------------------- */
function addProductToGrid(product, grid) {
    const div = document.createElement("div");
    div.className = "product";

    div.innerHTML = `
        <img src="${product.images?.[0] || ''}">
        <h3>${product.name}</h3>
        <p>$${product.price}</p>
        <button class="addBtn">Add to Cart</button>
        <button class="buyBtn">Buy Now</button>
    `;

    div.querySelector(".addBtn").onclick = async () => {
        cart.push(product);
        document.getElementById("cartCount").innerText = cart.length;
        await saveCartToFirebase(); // <-- ADDED
    };

    div.querySelector(".buyBtn").onclick = () => {
        alert(`Buying ${product.name}`);
    };

    grid.appendChild(div);
}

/* -------------------- CHECKOUT ----------------------- */
function renderCheckout() {
    const grid = document.getElementById("productGrid");
    grid.innerHTML = "<h2>Your Cart</h2>";

    if (!cart.length) {
        grid.innerHTML += "<p>Cart is empty.</p>";
        return;
    }

    cart.forEach(product => {
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
            <img src="${product.images?.[0]}">
            <h3>${product.name}</h3>
            <p>$${product.price}</p>
        `;
        grid.appendChild(div);
    });
}

/* -------------------- EVENTS ----------------------- */
document.querySelectorAll(".categories a").forEach(link => {
    link.addEventListener("click", e => {
        e.preventDefault();
        renderProducts(link.dataset.category);
    });
});

document.getElementById("logoLink").onclick = () => renderProducts("home");
document.getElementById("cartIcon").onclick = () => renderCheckout();

renderProducts("electronics");
</script>

</body>
</html>

