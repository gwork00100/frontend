<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrimeShift â€” Amazon Style Store</title>
<link rel="stylesheet" href="styles.css">

<script src="https://js.stripe.com/v3/"></script>


</head>
<body>

<header class="header">

    <div class="hamburger" id="hamburgerMenu">
    &#9776; <!-- This is the 3-bar icon -->
</div>


    <div class="logo">
        <a href="#" id="logoLink" style="color:white; text-decoration:none; font-weight:bold; font-size:24px;">PrimeShift</a>
    </div>
    <div class="search-bar">

        <input type="text" placeholder="Search productsâ€¦" id="searchInput" style="flex:1; padding:6px 10px; font-size:14px; border:none; border-radius:4px 0 0 4px; height:32px;">
        <button style="padding:8px 16px; font-size:14px; border:none; background:#febd69; cursor:pointer; border-radius:0 4px 4px 0; height:44px;">Search</button>
    </div>
<div class="header-right">
    <div class="account" id="accountBox">
        <div id="accountHello">Hello, Sign in</div>
        <div id="accountMain">Account & Lists â–¼</div>
        <!-- Dropdown -->
        <div id="accountMenu">
            <div id="accountEmail"></div>
            <button id="logoutBtn">Logout</button>
        </div>
    </div>

    <!-- Replace old orders div with this -->
    <div class="returns-orders">
        Returns & Orders
    </div>

    <div class="cart" id="cartIcon">
        <img src="https://img.icons8.com/ios-filled/50/ffffff/shopping-cart.png"/>
        <span id="cartCount">0</span>
    </div>
</div>


</div>

        
    </div>
</header>




<!-- âœ… Sidebar goes here -->
<div id="mobileSidebar">
    <button id="closeSidebar">&times;</button>
    <div class="sidebar-content">
        <a href="#" id="mobileSignIn">Sign In</a>
        <a href="#">Browse Products</a>
        <a href="#">Home</a>
        <hr>
        <h4>Trending</h4>
        <a href="#">Best Sellers</a>
        <a href="#">New Releases</a>
        <a href="#">Movers & Shakers</a>
        <hr>
        <h4>Top Departments</h4>
        <a href="#">Electronics</a>
        <a href="#">Clothing</a>
        <a href="#">Games</a>
        <a href="#">Fitness</a>
    </div>
</div>

<!-- Your auth box starts here -->

<div id="authBox" style="padding:15px; background:#fff3cd; display:none;">
    <h3>Sign In</h3>

    <button id="googleLogin" 
        style="padding:8px; background:#4285F4; color:white; border:none; cursor:pointer;">
        Sign in with Google
    </button>

    <br><br>

    <input id="emailInput" type="email" placeholder="Email"
        style="padding:8px; width:200px;"><br><br>

    <input id="passwordInput" type="password" placeholder="Password"
        style="padding:8px; width:200px;"><br><br>

    <button id="emailLogin" style="padding:8px; background:#febd69; border:none; cursor:pointer;">
        Sign in with Email
    </button>

    <button id="emailSignup" style="padding:8px; background:#ffa41c; border:none; cursor:pointer;">
        Create Account
    </button>

    <br><br>
    <button id="closeAuth" style="padding:5px;">Close</button>
</div>


<nav class="categories">
    <a href="#" data-category="electronics">Electronics</a>
    <a href="#" data-category="clothing">Clothing</a>
    <a href="#" data-category="games">Games</a>
    <a href="#" data-category="fitness">Fitness</a>
     <a href="#" data-category="beauty">Beauty</a>
     <a href="#" data-category="health">Health</a>
    <a href="#" data-category="automotive">Automotive</a>
    <a href="#" data-category="more">More</a>
</nav>

<section class="products" id="productGrid"></section>




<script type="module">

    
/* -------------------- IMPORTS ----------------------- */
import { db, auth } from './firebaseConfig.js';
import { collection, query, where, getDocs, doc, setDoc, getDoc } 
    from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    /* -------------------- MOBILE SIDEBAR TOGGLE -------------------- */


const hamburger = document.getElementById("hamburgerMenu");
const mobileSidebar = document.getElementById("mobileSidebar");
const closeSidebar = document.getElementById("closeSidebar");

hamburger.addEventListener("click", () => {
    console.log("HAMBURGER CLICKED"); // Debug
    mobileSidebar.style.transform = "translateX(0)";
});

closeSidebar.addEventListener("click", () => {
    console.log("CLOSE CLICKED"); // Debug
    mobileSidebar.style.transform = "translateX(-100%)";
});

// Close when clicking outside
document.addEventListener("click", (e) => {
    if (
        !mobileSidebar.contains(e.target) &&
        !hamburger.contains(e.target)
    ) {
        mobileSidebar.style.transform = "translateX(-100%)";
    }
});






/* -------------------- AUTH IMPORTS (ADD THESE) ----------------------- */
import { 
    GoogleAuthProvider, signInWithPopup,
    signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";


/* -------------------- FIX: Grab inputs AFTER imports ----------------------- */
const emailInput = document.getElementById("emailInput");
const passwordInput = document.getElementById("passwordInput");


/* -------------------- AUTH BUTTON LOGIC (ADD THIS) ----------------------- */

// ACCOUNT BOX CLICK (Login OR Dropdown)
document.getElementById("accountBox").onclick = () => {
    if (currentUser) {
        // User is logged in â†’ toggle dropdown
        const menu = document.getElementById("accountMenu");
        menu.style.display = (menu.style.display === "block") ? "none" : "block";
    } else {
        // User is logged out â†’ open login popup
        document.getElementById("authBox").style.display = "block";
    }
};


// Close login popup
document.getElementById("closeAuth").onclick = () => {
    document.getElementById("authBox").style.display = "none";
};

// GOOGLE LOGIN
document.getElementById("googleLogin").onclick = async () => {
    try {
        await signInWithPopup(auth, new GoogleAuthProvider());
        alert("Logged in with Google!");
        document.getElementById("authBox").style.display = "none";
        await loadCartFromFirebase();
    } catch (e) {
        alert(e.message);
    }
};



// EMAIL LOGIN
document.getElementById("emailLogin").onclick = async () => {
    const email = emailInput.value;
    const pass = passwordInput.value;

    try {
        await signInWithEmailAndPassword(auth, email, pass);
        alert("Logged in!");
        document.getElementById("authBox").style.display = "none";
        await loadCartFromFirebase();
    } catch (e) {
        alert(e.message);
    }
};

// EMAIL SIGNUP (FIXED)
document.getElementById("emailSignup").onclick = async () => {
    const email = emailInput.value.trim();
    const pass = passwordInput.value.trim();

    if (!email || !pass) {
        alert("Please enter a valid email and password.");
        return;
    }

    try {
        await createUserWithEmailAndPassword(auth, email, pass);
        alert("Account created!");
        document.getElementById("authBox").style.display = "none";
    } catch (e) {
        alert(e.message);
    }
};


// LOGOUT on right-click
document.querySelector(".account").oncontextmenu = async e => {
    e.preventDefault();
    await signOut(auth);
    alert("Logged out!");
    cart = [];
    document.getElementById("cartCount").innerText = 0;
};



/* -------------------- YOUR EXISTING CODE CONTINUES BELOW ----------------------- */

let cart = [];
let currentUser = null;


function updateQty(id, change) {
    const idx = cart.findIndex(p => p.id == id);
    if (idx > -1) {
        if (change === -1 && cart.filter(p => p.id == id).length === 1) {
            cart = cart.filter(p => p.id != id);
        } else if (change === -1) {
            const i = cart.findIndex(p => p.id == id);
            cart.splice(i, 1);
        } else if (change === +1) {
            cart.push(cart[idx]);
        }
        renderCheckout();
    }
}

function removeItem(id) {
    cart = cart.filter(p => p.id != id);
    renderCheckout();
}



const productsData = {
    home: [{name:"Welcome to PrimeShift!", price:0, img:""}],
    electronics: [
        {name:"Laptop", price:899.99, images:["https://via.placeholder.com/150/0000FF","https://via.placeholder.com/150/FF0000","https://via.placeholder.com/150/00FF00"]},
        {name:"Smartphone", price:399.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
        {name:"Headphones", price:129.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    clothing: [
        {name:"T-Shirt", price:19.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
        {name:"Jeans", price:49.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    games: [
        {name:"Console", price:399.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    fitness: [
        {name:"Dumbbells", price:49.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    beauty: [
        {name:"Lotion", price:49.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    health: [
        {name:"vitamins", price:49.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ],
    automotive: [
    {name:"Car Oil", price:29.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Tire", price:129.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"GPS Navigator", price:199.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Car Cover", price:59.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Car Battery", price:89.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Car Vacuum", price:39.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]},
    {name:"Windshield Wipers", price:24.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
],

    more: [
        {name:"Books", price:14.99, images:["https://via.placeholder.com/150","https://via.placeholder.com/150","https://via.placeholder.com/150"]}
    ]
};




/* -------------------- LOGIN STATE TRACKING ----------------------- */

auth.onAuthStateChanged(async user => {
    currentUser = user;

    const hello = document.getElementById("accountHello");
    const emailBox = document.getElementById("accountEmail");
    const logoutBtn = document.getElementById("logoutBtn");

    if (user) {
        // Logged in
        hello.innerText = `Hello, ${user.email.split("@")[0]}`;
        emailBox.innerText = user.email;
        emailBox.style.display = "block";
        logoutBtn.style.display = "block";

        console.log("User logged in:", user.uid);
        await loadCartFromFirebase();

    } else {
        // Logged out
        hello.innerText = "Hello, Sign in";
        emailBox.style.display = "none";
        logoutBtn.style.display = "none";

        cart = [];
        document.getElementById("cartCount").innerText = 0;

        console.log("No user logged in");
    }
});
// LOGOUT BUTTON
document.getElementById("logoutBtn").onclick = async () => {
    await signOut(auth);
    alert("You have been logged out.");
};




/* -------------------- SAVE CART TO FIREBASE ----------------------- */
async function saveCartToFirebase() {
    if (!currentUser) return;
    await setDoc(doc(db, "carts", currentUser.uid), {
        items: cart
    });
}



/* -------------------- LOAD CART FROM FIREBASE ----------------------- */
async function loadCartFromFirebase() {
    if (!currentUser) return;
    const ref = doc(db, "carts", currentUser.uid);
    const snap = await getDoc(ref);

    if (snap.exists()) {
        cart = snap.data().items;
        document.getElementById("cartCount").innerText = cart.length;
    }
}

/* -------------------- RENDER PRODUCTS ----------------------- */

async function renderProducts(category) {
    const grid = document.getElementById("productGrid");
    grid.innerHTML = "";

    try {
        const q = query(collection(db, "products"), where("category", "==", category));
        const snapshot = await getDocs(q);

        console.log("Category:", category);
        console.log("Firestore docs:", snapshot.docs.map(d => d.data()));

        snapshot.forEach(doc => addProductToGrid(doc.data(), grid));

        if (snapshot.empty) {
            grid.innerHTML = "<p>No products found in this category.</p>";
        }
    } catch (err) {
        console.error(err);
        grid.innerHTML = "<p>Error loading products.</p>";
    }
}

/* -------------------- ADD PRODUCT CARD ----------------------- */
function addProductToGrid(product, grid) {
    const div = document.createElement("div");
    div.className = "product";

    div.innerHTML = `
        <img src="${product.images?.[0] || ''}">
        <h3>${product.name}</h3>
        <p>$${product.price}</p>
        <button class="addBtn">Add to Cart</button>
        <button class="buyBtn">Buy Now</button>
    `;

    div.querySelector(".addBtn").onclick = async () => {
        cart.push(product);
        document.getElementById("cartCount").innerText = cart.length;
        await saveCartToFirebase(); // <-- ADDED
    };

    div.querySelector(".buyBtn").onclick = () => {
        alert(`Buying ${product.name}`);
    };

    grid.appendChild(div);
}

/* -------------------- CHECKOUT ----------------------- */
function renderCheckout() {
    const grid = document.getElementById("productGrid");

    // GROUP ITEMS BY ID
    const grouped = {};
    cart.forEach(item => {
        if (!grouped[item.id]) grouped[item.id] = { ...item, qty: 0 };
        grouped[item.id].qty++;
    });

    const items = Object.values(grouped);

    grid.innerHTML = `
        <h2>Your Cart</h2>
        <div id="cartList"></div>
        <h3 id="cartTotal"></h3>
        <button id="proceedCheckoutBtn" style="
            padding:12px;
            width:200px;
            font-size:16px;
            background:#f08804;
            border:none;
            cursor:pointer;
            border-radius:6px;
            margin-top:20px;
        ">Proceed to Checkout</button>
    `;

    const list = document.getElementById("cartList");
    let total = 0;

    items.forEach(item => {
        total += item.price * item.qty;

        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
            <img src="${item.images?.[0]}">
            <h3>${item.name}</h3>
            <p>$${item.price} x ${item.qty}</p>

            <button class="qtyPlus" data-id="${item.id}">+</button>
            <button class="qtyMinus" data-id="${item.id}">-</button>
            <button class="removeItem" data-id="${item.id}" style="background:red;color:white;">Remove</button>
        `;
        list.appendChild(div);
    });

    document.getElementById("cartTotal").innerText = "Total: $" + total.toFixed(2);

    // Quantity & Remove buttons
    document.querySelectorAll(".qtyPlus").forEach(btn =>
        btn.onclick = () => updateQty(btn.dataset.id, +1)
    );

    document.querySelectorAll(".qtyMinus").forEach(btn =>
        btn.onclick = () => updateQty(btn.dataset.id, -1)
    );

    document.querySelectorAll(".removeItem").forEach(btn =>
        btn.onclick = () => removeItem(btn.dataset.id)
    );

    // Checkout button â†’ go to checkout.html
document.getElementById("proceedCheckoutBtn").onclick = () => {
    window.location.href = "checkout.html";
};

}


/* -------------------- EVENTS ----------------------- */

/* -------------------- CATEGORY CLICK HANDLERS ----------------------- */
document.querySelectorAll(".categories a").forEach(link => {
    link.onclick = (e) => {
        e.preventDefault(); // Prevent default link behavior
        const category = link.dataset.category.toLowerCase().trim();
        renderProducts(category); // Call your function to populate products
    };
});

/* -------------------- CART & ORDERS CLICK HANDLERS ----------------------- */
// Cart icon â†’ open checkout
document.getElementById("cartIcon").onclick = () => {
    renderCheckout();
};

// Returns / Orders â†’ open checkout
const orders = document.querySelector(".returns-orders");
if (orders) {
    orders.onclick = () => renderCheckout();
}



/* -------------------- LOGO CLICK â†’ GO HOME ----------------------- */
document.getElementById("logoLink").onclick = (e) => {
    e.preventDefault();
    renderProducts("home");
};




</script>
<div id="aiChatButton">ðŸ’¬</div>
<div id="aiChatWindow"></div>

<script type="module" src="aiChat.js"></script>





</body>
</html>

